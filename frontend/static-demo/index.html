<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Prediction (Static Demo)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      .container { max-width: 960px; margin: 0 auto; }
      .row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; }
      input, button { padding: 8px 10px; font-size: 16px; }
      button { background: #2563eb; color: #fff; border: 0; border-radius: 6px; cursor: pointer; }
      button:disabled { opacity: .6; cursor: not-allowed; }
      .chart { height: 360px; margin-top: 24px; }
      .error { color: #b91c1c; margin-top: 12px; }
      table { width: 100%; border-collapse: collapse; margin-top: 12px; }
      th, td { padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: left; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Stock Price Prediction — Static Demo</h1>
      <p>Backend must be running at <code>http://localhost:5000</code>.</p>
      <div class="row">
        <label>Ticker</label>
        <input id="ticker" placeholder="RELIANCE" value="RELIANCE" />
        <label>Days</label>
        <input id="days" type="number" value="5" min="1" max="5" />
        <button id="btn">Predict</button>
      </div>
      <div class="error" id="error"></div>
      <table id="table" style="display:none">
        <thead><tr><th>Date</th><th>Predicted Price (INR)</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="chart"><canvas id="chart"></canvas></div>
    </div>
    <script>
      const btn = document.getElementById('btn');
      const errEl = document.getElementById('error');
      const table = document.getElementById('table');
      const tbody = table.querySelector('tbody');
      const ctx = document.getElementById('chart').getContext('2d');
      let chart;

      btn.addEventListener('click', async () => {
        errEl.textContent = '';
        tbody.innerHTML = '';
        table.style.display = 'none';
        btn.disabled = true;
        const ticker = document.getElementById('ticker').value.trim() || 'RELIANCE';
        const days = Math.min(Math.max(parseInt(document.getElementById('days').value||5,10),1),5);
        try {
          const resp = await fetch('http://localhost:5000/api/predict', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ticker, days })
          });
          const data = await resp.json();
          if (!resp.ok || data.error) throw new Error(data.error || ('HTTP '+resp.status));
          const labels = data.predictions.map(p => p.date);
          const values = data.predictions.map(p => p.price);
          // table
          data.predictions.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${p.date}</td><td>₹${p.price}</td>`;
            tbody.appendChild(tr);
          });
          table.style.display = '';
          // chart
          if (chart) { chart.destroy(); }
          chart = new Chart(ctx, {
            type: 'line',
            data: { labels, datasets: [{ label: 'Predicted Price (INR)', data: values, borderColor: '#2563eb', backgroundColor: 'rgba(37,99,235,.12)', borderWidth: 3, fill: true, tension: .4 }] },
            options: { responsive: true, maintainAspectRatio: false }
          });
        } catch (e) {
          errEl.textContent = e.message || String(e);
        } finally {
          btn.disabled = false;
        }
      });
    </script>
  </body>
  </html>
